-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://redmine.postgresql.org/projects/pgadmin4/issues/new if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public.admins
(
    firstname character varying(255) COLLATE pg_catalog."default",
    lastname character varying(255) COLLATE pg_catalog."default",
    phone character varying(255) COLLATE pg_catalog."default",
    admin_id bigint NOT NULL,
    CONSTRAINT admins_pkey PRIMARY KEY (admin_id)
);

CREATE TABLE IF NOT EXISTS public.class_rooms
(
    classroom_id bigint NOT NULL DEFAULT nextval('class_rooms_classroom_id_seq'::regclass),
    class_room character varying(255) COLLATE pg_catalog."default",
    CONSTRAINT class_rooms_pkey PRIMARY KEY (classroom_id)
);

CREATE TABLE IF NOT EXISTS public.course_registration
(
    registration_id bigint NOT NULL DEFAULT nextval('course_registration_registration_id_seq'::regclass),
    registered_at timestamp without time zone,
    course_id bigint,
    student_id bigint,
    CONSTRAINT course_registration_pkey PRIMARY KEY (registration_id)
);

CREATE TABLE IF NOT EXISTS public.courses
(
    course_id bigint NOT NULL DEFAULT nextval('courses_course_id_seq'::regclass),
    course_code character varying(255) COLLATE pg_catalog."default",
    course_name character varying(255) COLLATE pg_catalog."default",
    teacher_id bigint,
    CONSTRAINT courses_pkey PRIMARY KEY (course_id),
    CONSTRAINT uk_p02ts69sh53ptd62m3c67v0 UNIQUE (course_code)
);

CREATE TABLE IF NOT EXISTS public.exams
(
    exam_id bigint NOT NULL DEFAULT nextval('exams_exam_id_seq'::regclass),
    description character varying(255) COLLATE pg_catalog."default",
    end_time character varying(255) COLLATE pg_catalog."default",
    exam_date date,
    exam_type character varying(255) COLLATE pg_catalog."default",
    start_time character varying(255) COLLATE pg_catalog."default",
    course_id bigint,
    registration_id bigint,
    classroom_id bigint,
    CONSTRAINT exams_pkey PRIMARY KEY (exam_id)
);

CREATE TABLE IF NOT EXISTS public.roles
(
    id bigint NOT NULL DEFAULT nextval('roles_id_seq'::regclass),
    name character varying(20) COLLATE pg_catalog."default",
    CONSTRAINT roles_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.students
(
    degree integer,
    department character varying(255) COLLATE pg_catalog."default",
    faculty character varying(255) COLLATE pg_catalog."default",
    firstname character varying(255) COLLATE pg_catalog."default",
    lastname character varying(255) COLLATE pg_catalog."default",
    registration_date timestamp without time zone,
    student_id bigint NOT NULL,
    CONSTRAINT students_pkey PRIMARY KEY (student_id)
);

CREATE TABLE IF NOT EXISTS public.teachers
(
    branch character varying(255) COLLATE pg_catalog."default",
    firstname character varying(255) COLLATE pg_catalog."default",
    lastname character varying(255) COLLATE pg_catalog."default",
    teacher_id bigint NOT NULL,
    CONSTRAINT teachers_pkey PRIMARY KEY (teacher_id)
);

CREATE TABLE IF NOT EXISTS public.user_roles
(
    user_id bigint NOT NULL,
    role_id bigint NOT NULL,
    CONSTRAINT user_roles_pkey PRIMARY KEY (user_id, role_id)
);

CREATE TABLE IF NOT EXISTS public.users
(
    id bigint NOT NULL DEFAULT nextval('users_id_seq'::regclass),
    email character varying(255) COLLATE pg_catalog."default",
    password character varying(255) COLLATE pg_catalog."default",
    user_name character varying(255) COLLATE pg_catalog."default",
    CONSTRAINT users_pkey PRIMARY KEY (id),
    CONSTRAINT uk_6dotkott2kjsp8vw4d0m25fb7 UNIQUE (email),
    CONSTRAINT uk_k8d0f2n7n88w1a16yhua64onx UNIQUE (user_name)
);

ALTER TABLE IF EXISTS public.admins
    ADD CONSTRAINT fk78t703fcj0xhfk5wt6lmpjkmr FOREIGN KEY (admin_id)
    REFERENCES public.users (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;
CREATE INDEX IF NOT EXISTS admins_pkey
    ON public.admins(admin_id);


ALTER TABLE IF EXISTS public.course_registration
    ADD CONSTRAINT fkc071hdq5s9glswrtq7rceuib8 FOREIGN KEY (course_id)
    REFERENCES public.courses (course_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.course_registration
    ADD CONSTRAINT fkj89arjdm0j0l1vby8hjjl9ng6 FOREIGN KEY (student_id)
    REFERENCES public.students (student_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.courses
    ADD CONSTRAINT fk468oyt88pgk2a0cxrvxygadqg FOREIGN KEY (teacher_id)
    REFERENCES public.teachers (teacher_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.exams
    ADD CONSTRAINT fk9qxfflpy5kax2mq20wdfbhj2t FOREIGN KEY (registration_id)
    REFERENCES public.course_registration (registration_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.exams
    ADD CONSTRAINT fkbcj3j0fn09dt5glos43fb2sc1 FOREIGN KEY (classroom_id)
    REFERENCES public.class_rooms (classroom_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.exams
    ADD CONSTRAINT fkr1qm93flajdaclug2fg8i7bcg FOREIGN KEY (course_id)
    REFERENCES public.courses (course_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.students
    ADD CONSTRAINT fknl1q3iljhy1184875o5nu9ryy FOREIGN KEY (student_id)
    REFERENCES public.users (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;
CREATE INDEX IF NOT EXISTS students_pkey
    ON public.students(student_id);


ALTER TABLE IF EXISTS public.teachers
    ADD CONSTRAINT fk86jhurirgkwy6rhvhwtwry516 FOREIGN KEY (teacher_id)
    REFERENCES public.users (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;
CREATE INDEX IF NOT EXISTS teachers_pkey
    ON public.teachers(teacher_id);


ALTER TABLE IF EXISTS public.user_roles
    ADD CONSTRAINT fkh8ciramu9cc9q3qcqiv4ue8a6 FOREIGN KEY (role_id)
    REFERENCES public.roles (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.user_roles
    ADD CONSTRAINT fkhfh9dx7w3ubf1co1vdev94g3f FOREIGN KEY (user_id)
    REFERENCES public.users (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;

END;
